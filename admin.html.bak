<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>题库系统 - 管理中心</title>
    <!-- 引入layui CSS -->
    <link rel="stylesheet" href="https://lib.baomitu.com/layui/2.8.18/css/layui.css">
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #f2f2f2;
            font-family: 'Microsoft YaHei', sans-serif;
        }
        
        .admin-container {
            display: flex;
            height: 100vh;
        }
        
        /* 左侧导航 */
        .admin-sidebar {
            width: 220px;
            background-color: #393D49;
            color: #fff;
            overflow-y: auto;
        }
        
        .sidebar-header {
            padding: 20px;
            text-align: center;
            background-color: #23915f;
            font-size: 18px;
            font-weight: bold;
        }
        
        .layui-nav-tree {
            background-color: transparent;
        }
        
        .layui-nav-tree .layui-nav-item a {
            color: #fff;
        }
        
        .layui-nav-tree .layui-nav-item a:hover {
            background-color: #4E5465;
        }
        
        .layui-nav-tree .layui-nav-itemed > a {
            background-color: #23915f;
        }
        
        /* 右侧内容区 */
        .admin-content {
            flex: 1;
            overflow-y: auto;
        }
        
        .content-header {
            background-color: #fff;
            padding: 0 20px;
            height: 60px;
            line-height: 60px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header-title {
            font-size: 18px;
            font-weight: bold;
        }
        
        .header-user {
            display: flex;
            align-items: center;
        }
        
        .content-main {
            padding: 20px;
        }
        
        /* 卡片样式 */
        .card {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .card-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e9ecef;
        }
        
        /* 数据统计卡片 */
        .stat-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 32px;
            font-weight: bold;
            color: #23915f;
            margin-bottom: 10px;
        }
        
        .stat-label {
            font-size: 14px;
            color: #666;
        }
        
        /* 响应式设计 */
        @media (max-width: 768px) {
            .admin-container {
                flex-direction: column;
            }
            
            .admin-sidebar {
                width: 100%;
                height: auto;
            }
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <!-- 左侧导航 -->
        <div class="admin-sidebar">
            <div class="sidebar-header">题库管理中心</div>
            <ul class="layui-nav layui-nav-tree" lay-filter="admin-nav">
                <!-- 仪表盘 -->
                <li class="layui-nav-item layui-nav-itemed">
                    <a href="#" lay-href="#dashboard">
                        <i class="layui-icon layui-icon-home"></i>
                        仪表盘
                    </a>
                </li>
                
                <!-- 题库管理 -->
                <li class="layui-nav-item">
                    <a href="javascript:;">
                        <i class="layui-icon layui-icon-folder"></i>
                        题库管理
                    </a>
                    <dl class="layui-nav-child">
                        <dd><a href="#" lay-href="#banks">题库列表</a></dd>
                        <dd><a href="#" lay-href="#add-bank">添加题库</a></dd>
                        <dd><a href="#" lay-href="#categories">分类管理</a></dd>
                    </dl>
                </li>
                
                <!-- 题目管理 -->
                <li class="layui-nav-item">
                    <a href="javascript:;">
                        <i class="layui-icon layui-icon-read"></i>
                        题目管理
                    </a>
                    <dl class="layui-nav-child">
                        <dd><a href="#" lay-href="#questions">题目列表</a></dd>
                        <dd><a href="#" lay-href="#add-question">添加题目</a></dd>
                    </dl>
                </li>
                
                <!-- 用户管理 -->
                <li class="layui-nav-item">
                    <a href="javascript:;">
                        <i class="layui-icon layui-icon-user"></i>
                        用户管理
                    </a>
                    <dl class="layui-nav-child">
                        <dd><a href="#" lay-href="#users">用户列表</a></dd>
                        <dd><a href="#" lay-href="#add-user">添加用户</a></dd>
                    </dl>
                </li>
                
                <!-- 错题管理 -->
                <li class="layui-nav-item">
                    <a href="javascript:;">
                        <i class="layui-icon layui-icon-note"></i>
                        错题管理
                    </a>
                    <dl class="layui-nav-child">
                        <dd><a href="#" lay-href="#wrong-questions">错题列表</a></dd>
                        <dd><a href="#" lay-href="#wrong-stats">错题统计</a></dd>
                    </dl>
                </li>
                
                <!-- 系统设置 -->
                <li class="layui-nav-item">
                    <a href="javascript:;">
                        <i class="layui-icon layui-icon-set"></i>
                        系统设置
                    </a>
                    <dl class="layui-nav-child">
                        <dd><a href="#" lay-href="#system-config">系统配置</a></dd>
                        <dd><a href="#" lay-href="#database-config">数据库配置</a></dd>
                    </dl>
                </li>
                
                <!-- 数据导入导出 -->
                <li class="layui-nav-item">
                    <a href="javascript:;">
                        <i class="layui-icon layui-icon-upload"></i>
                        数据导入导出
                    </a>
                    <dl class="layui-nav-child">
                        <dd><a href="#" lay-href="#import-data">导入数据</a></dd>
                        <dd><a href="#" lay-href="#export-data">导出数据</a></dd>
                    </dl>
                </li>
            </ul>
        </div>
        
        <!-- 右侧内容区 -->
        <div class="admin-content">
            <!-- 顶部导航 -->
            <div class="content-header">
                <div class="header-title">管理中心</div>
                <div class="header-user">
                    <span>管理员</span>
                    <a href="index.html" class="layui-btn layui-btn-sm layui-btn-primary" style="margin-left: 20px;">
                        返回首页
                    </a>
                </div>
            </div>
            
            <!-- 主内容区 -->
            <div class="content-main">
                <!-- 数据统计卡片 -->
                <div class="stat-cards">
                    <div class="stat-card">
                        <div class="stat-number" id="total-questions">0</div>
                        <div class="stat-label">总题目数</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="total-users">0</div>
                        <div class="stat-label">总用户数</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="total-wrong">0</div>
                        <div class="stat-label">错题总数</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="total-categories">0</div>
                        <div class="stat-label">分类总数</div>
                    </div>
                </div>
                
                <!-- 仪表盘内容 -->
                <div class="card" id="dashboard">
                    <div class="card-title">系统概览</div>
                    <div class="layui-row">
                        <div class="layui-col-md6">
                            <div style="height: 300px; background-color: #f8f9fa; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: #666;">
                                <i class="layui-icon layui-icon-chart" style="font-size: 60px;"></i>
                                <span style="margin-left: 10px; font-size: 18px;">数据统计图表</span>
                            </div>
                        </div>
                        <div class="layui-col-md6">
                            <div style="height: 300px; background-color: #f8f9fa; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: #666;">
                                <i class="layui-icon layui-icon-rank" style="font-size: 60px;"></i>
                                <span style="margin-left: 10px; font-size: 18px;">最近活跃用户</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 分类表格操作列模板 -->
                <script type="text/html" id="categories-toolbar">
                    <a class="layui-btn layui-btn-xs layui-btn-primary" lay-event="edit">
                        <i class="layui-icon layui-icon-edit"></i> 编辑
                    </a>
                    <a class="layui-btn layui-btn-xs layui-btn-danger" lay-event="del">
                        <i class="layui-icon layui-icon-delete"></i> 删除
                    </a>
                </script>
                
                <!-- 题目表格操作列模板 -->
                <script type="text/html" id="questions-toolbar">
                    <a class="layui-btn layui-btn-xs layui-btn-primary" lay-event="edit">
                        <i class="layui-icon layui-icon-edit"></i> 编辑
                    </a>
                    <a class="layui-btn layui-btn-xs layui-btn-danger" lay-event="del">
                        <i class="layui-icon layui-icon-delete"></i> 删除
                    </a>
                </script>
                
                <!-- 题库表格操作列模板 -->
                <script type="text/html" id="banks-toolbar">
                    <a class="layui-btn layui-btn-xs layui-btn-primary" lay-event="edit">
                        <i class="layui-icon layui-icon-edit"></i> 编辑
                    </a>
                    <a class="layui-btn layui-btn-xs layui-btn-danger" lay-event="del">
                        <i class="layui-icon layui-icon-delete"></i> 删除
                    </a>
                </script>
                
                <!-- 错题/收藏表格操作列模板 -->
                <script type="text/html" id="wrong-questions-toolbar">
                    <a class="layui-btn layui-btn-xs layui-btn-primary" lay-event="review" {{d.type === 1 ? "style=\"display:none;\"" : ""}}>
                        <i class="layui-icon layui-icon-ok"></i> 标记复习
                    </a>
                    <a class="layui-btn layui-btn-xs layui-btn-normal" lay-event="toggle-type">
                        <i class="layui-icon layui-icon-switch"></i> 切换{{d.type === 0 ? "收藏" : "错题"}}
                    </a>
                    <a class="layui-btn layui-btn-xs layui-btn-danger" lay-event="del">
                        <i class="layui-icon layui-icon-delete"></i> 删除
                    </a>
                </script>
                
                <!-- 其他模块内容（默认隐藏，通过导航切换显示） -->
                <!-- 题库列表 -->
                <div class="card" id="banks" style="display: none;">
                    <div class="card-title">
                        <span>题库列表</span>
                        <button class="layui-btn layui-btn-sm layui-btn-primary" style="float: right;" id="add-bank-btn">
                            <i class="layui-icon layui-icon-add-1"></i> 添加题库
                        </button>
                    </div>
                    
                    <!-- 题库表格 -->
                    <table class="layui-table" id="banks-table" lay-filter="banks-filter"></table>
                </div>
                
                <!-- 添加题库 -->
                <div class="card" id="add-bank" style="display: none;">
                    <div class="card-title">
                        <span>添加题库</span>
                        <button class="layui-btn layui-btn-sm layui-btn-primary" style="float: right;" id="back-to-banks">
                            <i class="layui-icon layui-icon-left"></i> 返回列表
                        </button>
                    </div>
                    
                    <!-- 添加题库表单 -->
                    <form class="layui-form layui-form-pane" id="bank-form" lay-filter="bank-form">
                        <input type="hidden" name="id">
                        
                        <div class="layui-form-item">
                            <label class="layui-form-label">题库名称</label>
                            <div class="layui-input-block">
                                <input type="text" name="name" placeholder="请输入题库名称" autocomplete="off" class="layui-input" lay-verify="required">
                            </div>
                        </div>
                        

                        
                        <div class="layui-form-item layui-form-text">
                            <label class="layui-form-label">题库描述</label>
                            <div class="layui-input-block">
                                <textarea name="description" placeholder="请输入题库描述" class="layui-textarea"></textarea>
                            </div>
                        </div>
                        
                        <div class="layui-form-item">
                            <div class="layui-input-block">
                                <button type="submit" class="layui-btn layui-btn-primary" lay-submit lay-filter="submit-bank">保存</button>
                                <button type="reset" class="layui-btn layui-btn-primary layui-btn-danger">重置</button>
                            </div>
                        </div>
                    </form>
                </div>
                
                <div class="card" id="questions" style="display: none;">
                    <div class="card-title">
                        <span>题目列表</span>
                        <button class="layui-btn layui-btn-sm layui-btn-primary" style="float: right;" id="add-question-btn">
                            <i class="layui-icon layui-icon-add-1"></i> 添加题目
                        </button>
                    </div>
                    
                    <!-- 搜索栏 -->
                    <div class="layui-form layui-form-pane" style="margin-bottom: 20px;">
                        <div class="layui-form-item">
                            <div class="layui-inline">
                                <label class="layui-form-label">题库</label>
                                <div class="layui-input-inline" style="width: 150px;">
                                    <select id="search-bank" lay-filter="search-bank">
                                        <option value="0">全部题库</option>
                                    </select>
                                </div>
                            </div>
                            <div class="layui-inline">
                                <label class="layui-form-label">类型</label>
                                <div class="layui-input-inline" style="width: 150px;">
                                    <select id="search-type" lay-filter="search-type">
                                        <option value="0">全部类型</option>
                                        <option value="1">单选</option>
                                        <option value="2">多选</option>
                                        <option value="3">判断</option>
                                        <option value="4">填空</option>
                                        <option value="5">简答</option>
                                    </select>
                                </div>
                            </div>
                            <div class="layui-inline">
                                <button class="layui-btn layui-btn-primary" id="search-btn">
                                    <i class="layui-icon layui-icon-search"></i> 搜索
                                </button>
                                <button class="layui-btn layui-btn-primary" id="reset-btn">
                                    <i class="layui-icon layui-icon-refresh"></i> 重置
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 题目表格 -->
                    <table class="layui-table" id="questions-table" lay-filter="questions-filter"></table>
                </div>
                
                <div class="card" id="add-question" style="display: none;">
                    <div class="card-title">
                        <span>添加题目</span>
                        <button class="layui-btn layui-btn-sm layui-btn-primary" style="float: right;" id="back-to-questions">
                            <i class="layui-icon layui-icon-left"></i> 返回列表
                        </button>
                    </div>
                    
                    <!-- 添加题目表单 -->
                    <form class="layui-form layui-form-pane" id="question-form" lay-filter="question-form">
                        <input type="hidden" name="id">
                        
                        <div class="layui-form-item">
                            <label class="layui-form-label">题目类型</label>
                            <div class="layui-input-block">
                                <select name="type" lay-filter="question-type" lay-verify="requiredType">
                                    <option value="1">单选</option>
                                    <option value="2">多选</option>
                                    <option value="3">判断</option>
                                    <option value="4">填空</option>
                                    <option value="5">简答</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="layui-form-item">
                            <label class="layui-form-label">所属题库</label>
                            <div class="layui-input-block">
                                <select name="bank_id" lay-filter="bank_id">
                                    <option value="0">默认题库</option>
                                </select>
                            </div>
                        </div>
                        

                        
                        <div class="layui-form-item">
                            <label class="layui-form-label">难度</label>
                            <div class="layui-input-block">
                                <select name="difficulty" lay-filter="difficulty">
                                    <option value="1">简单</option>
                                    <option value="2" selected>中等</option>
                                    <option value="3">困难</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="layui-form-item layui-form-text">
                            <label class="layui-form-label">题目内容</label>
                            <div class="layui-input-block">
                                <textarea name="content" placeholder="请输入题目内容" class="layui-textarea" lay-verify="requiredContent" style="height: 100px;"></textarea>
                            </div>
                        </div>
                        
                        <!-- 选择题选项 -->
                        <div class="choice-options" style="display: none;">
                            <div class="layui-form-item">
                                <label class="layui-form-label">选项</label>
                                <div class="layui-input-block">
                                    <!-- 单条输入区域 -->
                                    <div class="single-input-section">
                                        <div class="options-container">
                                            <!-- 初始默认显示4个单条输入框 -->
                                            <div class="option-item" style="margin-bottom: 10px;">
                                                <div class="layui-row">
                                                    <div class="layui-col-md1">
                                                        <div class="layui-form-mid layui-word-aux" style="font-weight: bold; font-size: 16px;">A</div>
                                                    </div>
                                                    <div class="layui-col-md10">
                                                        <input type="text" name="options[0][content]" placeholder="选项内容" class="layui-input" style="margin-bottom: 5px;" lay-verify="requiredOption">
                                                    </div>
                                                    <div class="layui-col-md1">
                                                        <input type="checkbox" name="options[0][is_correct]" lay-skin="primary" title="正确">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="option-item" style="margin-bottom: 10px;">
                                                <div class="layui-row">
                                                    <div class="layui-col-md1">
                                                        <div class="layui-form-mid layui-word-aux" style="font-weight: bold; font-size: 16px;">B</div>
                                                    </div>
                                                    <div class="layui-col-md10">
                                                        <input type="text" name="options[1][content]" placeholder="选项内容" class="layui-input" style="margin-bottom: 5px;" lay-verify="requiredOption">
                                                    </div>
                                                    <div class="layui-col-md1">
                                                        <input type="checkbox" name="options[1][is_correct]" lay-skin="primary" title="正确">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="option-item" style="margin-bottom: 10px;">
                                                <div class="layui-row">
                                                    <div class="layui-col-md1">
                                                        <div class="layui-form-mid layui-word-aux" style="font-weight: bold; font-size: 16px;">C</div>
                                                    </div>
                                                    <div class="layui-col-md10">
                                                        <input type="text" name="options[2][content]" placeholder="选项内容" class="layui-input" style="margin-bottom: 5px;" lay-verify="requiredOption">
                                                    </div>
                                                    <div class="layui-col-md1">
                                                        <input type="checkbox" name="options[2][is_correct]" lay-skin="primary" title="正确">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="option-item" style="margin-bottom: 10px;">
                                                <div class="layui-row">
                                                    <div class="layui-col-md1">
                                                        <div class="layui-form-mid layui-word-aux" style="font-weight: bold; font-size: 16px;">D</div>
                                                    </div>
                                                    <div class="layui-col-md10">
                                                        <input type="text" name="options[3][content]" placeholder="选项内容" class="layui-input" style="margin-bottom: 5px;" lay-verify="requiredOption">
                                                    </div>
                                                    <div class="layui-col-md1">
                                                        <input type="checkbox" name="options[3][is_correct]" lay-skin="primary" title="正确">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <button type="button" class="layui-btn layui-btn-sm layui-btn-primary" id="add-option">
                                            <i class="layui-icon layui-icon-add-1"></i> 添加选项
                                        </button>
                                    </div>
                                    
                                    <!-- 批量输入区域 -->
                                    <div class="batch-input-section" style="margin-top: 20px;">
                                        <div class="layui-form-item">
                                            <label class="layui-form-label">批量输入</label>
                                            <div class="layui-input-block">
                                                <div style="display: flex; align-items: center;">
                                                    <input type="text" name="batch_options" placeholder="请输入选项，用竖线分隔（如：宣誓|训练|教育|劳动）" class="layui-input" style="margin-right: 10px;">
                                                    <input type="text" name="answer" placeholder="答案（如：A、AC）" class="layui-input" style="width: 150px;">
                                                </div>
                                                <div class="layui-form-mid layui-word-aux">格式说明：选项内容之间用竖线分隔，系统会自动分解内容并填充到上方单条输入框</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 填空题/简答题答案 -->
                        <div class="answer-section">
                            <div class="layui-form-item layui-form-text">
                                <label class="layui-form-label">答案</label>
                                <div class="layui-input-block">
                                    <textarea name="non_choice_answer" placeholder="请输入答案" class="layui-textarea" style="height: 80px;"></textarea>
                                </div>
                            </div>
                        </div>
                        
                        <div class="layui-form-item layui-form-text">
                            <label class="layui-form-label">解析</label>
                            <div class="layui-input-block">
                                <textarea name="analysis" placeholder="请输入解析" class="layui-textarea" style="height: 100px;"></textarea>
                            </div>
                        </div>
                        
                        <div class="layui-form-item">
                            <div class="layui-input-block">
                                <button type="submit" class="layui-btn layui-btn-primary" lay-submit lay-filter="submit-question">保存</button>
                                <button type="reset" class="layui-btn layui-btn-primary layui-btn-danger">重置</button>
                            </div>
                        </div>
                    </form>
                </div>
                
                <div class="card" id="categories" style="display: none;">
                    <div class="card-title">
                        <span>分类管理</span>
                        <button class="layui-btn layui-btn-sm layui-btn-primary" style="float: right;" id="add-category-btn">
                            <i class="layui-icon layui-icon-add-1"></i> 添加分类
                        </button>
                    </div>
                    
                    <!-- 分类表格 -->
                    <table class="layui-table" id="categories-table" lay-filter="categories-filter"></table>
                    
                    <!-- 添加/编辑分类模态框 -->
                    <div id="category-modal" style="display: none; padding: 20px;">
                        <form class="layui-form" id="category-form" lay-filter="category-form">
                            <div class="layui-form-item">
                                <label class="layui-form-label">分类名称</label>
                                <div class="layui-input-block">
                                    <input type="text" name="name" lay-verify="required" placeholder="请输入分类名称" autocomplete="off" class="layui-input">
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">上级分类</label>
                                <div class="layui-input-block">
                                    <select name="parent_id" lay-filter="parent_id">
                                        <option value="0">顶级分类</option>
                                    </select>
                                </div>
                            </div>

                            <div class="layui-form-item">
                                <label class="layui-form-label">描述</label>
                                <div class="layui-input-block">
                                    <textarea name="description" placeholder="请输入分类描述" class="layui-textarea"></textarea>
                                </div>
                            </div>
                            <input type="hidden" name="id">
                        </form>
                    </div>
                </div>
                
                <div class="card" id="users" style="display: none;">
                    <div class="card-title">用户列表</div>
                    <div style="height: 400px; background-color: #f8f9fa; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: #666;">
                        <i class="layui-icon layui-icon-user" style="font-size: 60px;"></i>
                        <span style="margin-left: 10px; font-size: 18px;">用户列表功能开发中</span>
                    </div>
                </div>
                
                <div class="card" id="add-user" style="display: none;">
                    <div class="card-title">添加用户</div>
                    <div style="height: 400px; background-color: #f8f9fa; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: #666;">
                        <i class="layui-icon layui-icon-user-plus" style="font-size: 60px;"></i>
                        <span style="margin-left: 10px; font-size: 18px;">添加用户功能开发中</span>
                    </div>
                </div>
                
                <!-- 错题/收藏列表 -->
                <div class="card" id="wrong-questions" style="display: none;">
                    <div class="card-title">
                        <span>错题与收藏管理</span>
                        <div class="layui-btn-group" style="float: right;">
                            <button class="layui-btn layui-btn-primary layui-btn-sm" id="wrong-question-type" data-type="0">错题</button>
                            <button class="layui-btn layui-btn-sm" id="favorite-type" data-type="1">收藏</button>
                        </div>
                    </div>
                    
                    <!-- 搜索栏 -->
                    <div class="layui-form layui-form-pane" style="margin-bottom: 20px;">
                        <div class="layui-form-item">
                            <div class="layui-inline">
                                <label class="layui-form-label">用户</label>
                                <div class="layui-input-inline" style="width: 150px;">
                                    <input type="text" id="search-user" placeholder="用户名或ID" class="layui-input">
                                </div>
                            </div>
                            <div class="layui-inline">
                                <label class="layui-form-label">复习状态</label>
                                <div class="layui-input-inline" style="width: 150px;">
                                    <select id="search-reviewed">
                                        <option value="-1">全部</option>
                                        <option value="0">未复习</option>
                                        <option value="1">已复习</option>
                                    </select>
                                </div>
                            </div>
                            <div class="layui-inline">
                                <button class="layui-btn layui-btn-primary" id="search-wrong-question">
                                    <i class="layui-icon layui-icon-search"></i> 搜索
                                </button>
                                <button class="layui-btn layui-btn-primary" id="reset-wrong-question">
                                    <i class="layui-icon layui-icon-refresh"></i> 重置
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 错题/收藏表格 -->
                    <table class="layui-table" id="wrong-questions-table" lay-filter="wrong-questions-filter"></table>
                </div>
                
                <!-- 错题统计 -->
                <div class="card" id="wrong-stats" style="display: none;">
                    <div class="card-title">错题与收藏统计</div>
                    
                    <!-- 统计卡片 -->
                    <div class="stat-cards">
                        <div class="stat-card">
                            <div class="stat-number" id="total-wrong-count">0</div>
                            <div class="stat-label">错题总数</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="total-favorite-count">0</div>
                            <div class="stat-label">收藏总数</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="total-unreviewed-count">0</div>
                            <div class="stat-label">未复习错题</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="total-reviewed-count">0</div>
                            <div class="stat-label">已复习错题</div>
                        </div>
                    </div>
                    
                    <!-- 图表区域 -->
                    <div style="margin-top: 20px;">
                        <div class="layui-row">
                            <div class="layui-col-md6">
                                <div class="card" style="height: 300px;">
                                    <div class="card-title">错题类型分布</div>
                                    <div id="wrong-type-chart" style="height: 250px;"></div>
                                </div>
                            </div>
                            <div class="layui-col-md6">
                                <div class="card" style="height: 300px;">
                                    <div class="card-title">错题难度分布</div>
                                    <div id="wrong-difficulty-chart" style="height: 250px;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card" id="system-config" style="display: none;">
                    <div class="card-title">系统配置</div>
                    <div style="height: 400px; background-color: #f8f9fa; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: #666;">
                        <i class="layui-icon layui-icon-set" style="font-size: 60px;"></i>
                        <span style="margin-left: 10px; font-size: 18px;">系统配置功能开发中</span>
                    </div>
                </div>
                
                <div class="card" id="database-config" style="display: none;">
                    <div class="card-title">数据库配置</div>
                    <div style="height: 400px; background-color: #f8f9fa; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: #666;">
                        <i class="layui-icon layui-icon-database" style="font-size: 60px;"></i>
                        <span style="margin-left: 10px; font-size: 18px;">数据库配置功能开发中</span>
                    </div>
                </div>
                
                <div class="card" id="import-data" style="display: none;">
                    <div class="card-title">
                        <span>导入数据</span>
                        <button class="layui-btn layui-btn-sm layui-btn-primary" style="float: right; margin-right: 10px;" id="parse-btn">
                            <i class="layui-icon layui-icon-read"></i> 解析数据
                        </button>
                        <button class="layui-btn layui-btn-sm layui-btn-normal" style="float: right;" id="import-btn">
                            <i class="layui-icon layui-icon-upload"></i> 导入数据
                        </button>
                    </div>
                    
                    <!-- 导入说明 -->
                    <div class="layui-form-item">
                        <div class="layui-card">
                            <div class="layui-card-header">导入说明</div>
                            <div class="layui-card-body">
                                <ul style="list-style: decimal; padding-left: 20px;">
                                    <li>请按照以下格式粘贴数据，每行一条记录，字段之间用Tab分隔：</li>
                                    <li>格式：序号	类型	题目	选项	答案	答案解析</li>
                                    <li>类型支持：单选、多选、判断、填空、简答</li>
                                    <li>选项用竖线分隔，例如：选项1|选项2|选项3|选项4</li>
                                    <li>填空和简答题不需要选项，直接在答案列填写答案</li>
                                    <li>序号不需要入库，仅作为行标识</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 数据输入区域 -->
                    <div class="layui-form-item">
                        <label class="layui-form-label">数据输入</label>
                        <div class="layui-input-block">
                            <textarea name="import_data" placeholder="请粘贴要导入的数据" class="layui-textarea" style="height: 200px;"></textarea>
                        </div>
                    </div>
                    
                    <!-- 解析结果预览区域 -->
                    <div class="layui-form-item">
                        <label class="layui-form-label">解析结果</label>
                        <div class="layui-input-block">
                            <table class="layui-table" id="parse-result" style="display: none;">
                                <thead>
                                    <tr>
                                        <th>序号</th>
                                        <th>类型</th>
                                        <th>题目</th>
                                        <th>选项</th>
                                        <th>答案</th>
                                        <th>解析</th>
                                    </tr>
                                </thead>
                                <tbody id="parse-result-body"></tbody>
                            </table>
                            <div id="parse-status" style="display: none; margin-top: 10px;"></div>
                        </div>
                    </div>
                </div>
                
                <div class="card" id="export-data" style="display: none;">
                    <div class="card-title">导出数据</div>
                    <div style="height: 400px; background-color: #f8f9fa; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: #666;">
                        <i class="layui-icon layui-icon-download" style="font-size: 60px;"></i>
                        <span style="margin-left: 10px; font-size: 18px;">导出数据功能开发中</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 引入layui JS -->
    <script src="https://lib.baomitu.com/layui/2.8.18/layui.js"></script>
    <script>
        layui.use(['element', 'layer', 'jquery', 'table', 'form'], function(){
            var element = layui.element;
            var layer = layui.layer;
            var $ = layui.jquery;
            var table = layui.table;
            var form = layui.form;
            
            // 导航点击事件
            element.on('nav(admin-nav)', function(elem) {
                // 获取lay-href属性
                var href = elem.attr('lay-href');
                if(href && href.startsWith('#')) {
                    // 隐藏所有内容卡片
                    $('.content-main .card').hide();
                    // 显示对应的内容卡片
                    $(href).show();
                    
                    // 如果是分类管理，初始化表格
                    if(href === '#categories') {
                        initCategoriesTable();
                    }
                    // 如果是题目管理，初始化表格
                    else if(href === '#questions') {
                        initQuestionsTable();
                    }
                    // 如果是题库管理，初始化表格
                    else if(href === '#banks') {
                        initBanksTable();
                    }
                    // 如果是错题/收藏管理，初始化表格
                    else if(href === '#wrong-questions') {
                        initWrongQuestionsTable();
                    }
                }
            });
            
            // 自定义表单验证规则
            form.verify({
                // 题目类型必填
                requiredType: function(value, item) {
                    if(!value) {
                        return '题目类型不能为空';
                    }
                },
                // 题目内容必填
                requiredContent: function(value, item) {
                    if(!value || value.trim() === '') {
                        return '题目内容不能为空';
                    }
                },
                // 答案必填
                requiredAnswer: function(value, item) {
                    if(!value || value.trim() === '') {
                        return '答案不能为空';
                    }
                },
                // 选项内容必填
                requiredOption: function(value, item) {
                    if(!value || value.trim() === '') {
                        return '选项内容不能为空';
                    }
                }
            });
            
            // 模拟数据统计
            function loadStats() {
                // 这里可以通过AJAX从服务器获取真实数据
                // 暂时使用模拟数据
                $('#total-questions').text('1,234');
                $('#total-users').text('567');
                $('#total-wrong').text('89');
                $('#total-categories').text('12');
            }
            
            // 分类管理相关功能
            // 初始化分类表格
            function initCategoriesTable() {
                table.render({
                    elem: '#categories-table',
                    url: 'api/categories.php',
                    method: 'GET',
                    page: false,
                    limit: 20,
                    height: 'full-150',
                    request: {
                        pageName: 'page', // 页码的参数名称，默认：page
                        limitName: 'limit' // 每页数据量的参数名，默认：limit
                    },
                    response: {
                        statusName: 'code', // 规定数据状态的字段名称，默认：code
                        statusCode: 200, // 规定成功的状态码，默认：0
                        msgName: 'msg', // 规定状态信息的字段名称，默认：msg
                        countName: 'count', // 规定数据总数的字段名称，默认：count
                        dataName: 'data' // 规定数据列表的字段名称，默认：data
                    },
                    cols: [[
                        {field: 'id', title: 'ID', width: 80, align: 'center'},
                        {field: 'name', title: '分类名称', minWidth: 120},
                        {field: 'description', title: '描述', minWidth: 150},
                        {field: 'parent_id', title: '上级分类ID', width: 120, align: 'center'},
                        {field: 'status', title: '状态', width: 100, align: 'center', templet: '<div>{{d.status === 1 ? "启用" : "禁用"}}</div>'},
                        {field: 'created_at', title: '创建时间', width: 160, align: 'center'},
                        {fixed: 'right', title: '操作', width: 160, align: 'center', toolbar: '#categories-toolbar'}
                    ]],
                    done: function(res) {
                        console.log('表格加载完成', res);
                        if(res.code === 200) {
                            // 更新统计数据
                            $('#total-categories').text(res.data.length);
                            // 加载分类选项到下拉框
                            loadCategoryOptions(res.data);
                        }
                    }
                });
                
                // 绑定工具栏事件
                table.on('tool(categories-filter)', function(obj) {
                    var data = obj.data;
                    if(obj.event === 'edit') {
                        // 编辑分类
                        editCategory(data);
                    } else if(obj.event === 'del') {
                        // 删除分类
                        deleteCategory(data.id);
                    }
                });
            }
            
            // 加载分类选项到下拉框
            function loadCategoryOptions(categories) {
                var select = $('select[name="parent_id"]');
                // 清空现有选项（保留顶级分类）
                select.find('option:not([value="0"])').remove();
                
                // 添加分类选项
                categories.forEach(function(category) {
                    if(category.parent_id === 0) {
                        select.append('<option value="' + category.id + '">' + category.name + '</option>');
                    }
                });
                
                // 重新渲染表单
                form.render('select');
            }
            
            // 添加分类按钮点击事件
            $('#add-category-btn').on('click', function() {
                openCategoryModal();
            });
            
            // 打开分类模态框
            function openCategoryModal(category) {
                // 清空表单
                $('#category-form')[0].reset();
                $('input[name="id"]').val('');
                
                // 如果是编辑，填充表单数据
                if(category) {
                    $('input[name="id"]').val(category.id);
                    $('input[name="name"]').val(category.name);
                    $('select[name="parent_id"]').val(category.parent_id);
                    $('textarea[name="description"]').val(category.description);
                    // 重新渲染表单
                    form.render();
                }
                
                // 打开模态框
                layer.open({
                    type: 1,
                    title: category ? '编辑分类' : '添加分类',
                    content: $('#category-modal'),
                    area: ['500px', 'auto'],
                    btn: ['确定', '取消'],
                    btn1: function(index, layero) {
                        // 提交表单
                        form.on('submit(category-form)', function(data) {
                            saveCategory(data.field);
                            layer.close(index);
                            return false;
                        });
                        
                        // 触发表单提交
                        $('#category-form').find('button[type="submit"]').trigger('click');
                    }
                });
            }
            
            // 编辑分类
            function editCategory(category) {
                openCategoryModal(category);
            }
            
            // 保存分类
            function saveCategory(categoryData) {
                var url = 'api/categories.php';
                var method = categoryData.id ? 'PUT' : 'POST';
                
                $.ajax({
                    url: url,
                    method: method,
                    contentType: 'application/json',
                    data: JSON.stringify(categoryData),
                    success: function(res) {
                        if(res.code === 200 || res.code === 201) {
                            layer.msg(res.msg, {icon: 1});
                            // 重新加载表格
                            table.reload('categories-table');
                        } else {
                            layer.msg(res.msg, {icon: 2});
                        }
                    },
                    error: function(xhr, status, error) {
                        layer.msg('操作失败: ' + error, {icon: 2});
                    }
                });
            }
            
            // 删除分类
            function deleteCategory(id) {
                layer.confirm('确定要删除这个分类吗？', {
                    btn: ['确定', '取消']
                }, function(index) {
                    $.ajax({
                        url: 'api/categories.php?id=' + id,
                        method: 'DELETE',
                        success: function(res) {
                            if(res.code === 200) {
                                layer.msg(res.msg, {icon: 1});
                                // 重新加载表格
                                table.reload('categories-table');
                            } else {
                                layer.msg(res.msg, {icon: 2});
                            }
                        },
                        error: function(xhr, status, error) {
                            layer.msg('删除失败: ' + error, {icon: 2});
                        }
                    });
                    
                    layer.close(index);
                });
            }
            
            // 监听表单提交
            form.on('submit(category-form)', function(data) {
                return false; // 阻止默认提交
            });
            
            // 错题/收藏管理相关功能
            // 初始化错题/收藏表格
            var currentType = 0; // 当前显示类型：0-错题，1-收藏
            
            function initWrongQuestionsTable() {
                table.render({
                    elem: '#wrong-questions-table',
                    url: 'api/wrong-questions.php',
                    method: 'GET',
                    page: false,
                    limit: 20,
                    height: 'full-150',
                    where: {
                        type: currentType
                    },
                    request: {
                        pageName: 'page', // 页码的参数名称，默认：page
                        limitName: 'limit' // 每页数据量的参数名，默认：limit
                    },
                    response: {
                        statusName: 'code', // 规定数据状态的字段名称，默认：code
                        statusCode: 200, // 规定成功的状态码，默认：0
                        msgName: 'msg', // 规定状态信息的字段名称，默认：msg
                        countName: 'count', // 规定数据总数的字段名称，默认：count
                        dataName: 'data' // 规定数据列表的字段名称，默认：data
                    },
                    cols: [[
                        {field: 'id', title: 'ID', width: 80, align: 'center'},
                        {field: 'user_id', title: '用户ID', width: 100, align: 'center'},
                        {field: 'question.content', title: '题目内容', minWidth: 300},
                        {field: 'bank_name', title: '所属题库', width: 150, align: 'center'},
                        {field: 'category_name', title: '分类', width: 150, align: 'center'},
                        {field: 'type', title: '类型', width: 100, align: 'center', templet: '<div>{{d.type === 0 ? "错题" : "收藏"}}</div>'},
                        {field: 'reviewed', title: '复习状态', width: 120, align: 'center', templet: '<div>{{d.type === 0 ? (d.reviewed === 1 ? "已复习" : "未复习") : "-"}}</div>'},
                        {field: 'created_at', title: '创建时间', width: 160, align: 'center'},
                        {field: 'reviewed_at', title: '复习时间', width: 160, align: 'center', templet: '<div>{{d.reviewed_at || "-"}}</div>'},
                        {fixed: 'right', title: '操作', width: 180, align: 'center', toolbar: '#wrong-questions-toolbar'}
                    ]],
                    done: function(res) {
                        if(res.code === 200) {
                            // 更新统计数据
                            if(currentType === 0) {
                                var reviewedCount = res.data.filter(item => item.reviewed === 1).length;
                                var unreviewedCount = res.data.length - reviewedCount;
                                $('#total-wrong-count').text(res.data.length);
                                $('#total-reviewed-count').text(reviewedCount);
                                $('#total-unreviewed-count').text(unreviewedCount);
                            } else {
                                $('#total-favorite-count').text(res.data.length);
                            }
                        }
                    }
                });
                
                // 绑定工具栏事件
                table.on('tool(wrong-questions-filter)', function(obj) {
                    var data = obj.data;
                    if(obj.event === 'review') {
                        // 标记为已复习
                        reviewWrongQuestion(data.id);
                    } else if(obj.event === 'del') {
                        // 删除错题/收藏
                        deleteWrongQuestion(data.id);
                    } else if(obj.event === 'toggle-type') {
                        // 切换类型
                        toggleWrongQuestionType(data.id, data.type);
                    }
                });
            }
            

            
            // 标记为已复习
            function reviewWrongQuestion(id) {
                $.ajax({
                    url: 'api/wrong-questions.php',
                    method: 'PUT',
                    contentType: 'application/json',
                    data: JSON.stringify({id: id, reviewed: 1}),
                    dataType: 'json',
                    success: function(res) {
                        if(res.code === 200) {
                            layer.msg(res.msg, {icon: 1});
                            // 重新加载表格
                            table.reload('wrong-questions-table');
                        } else {
                            layer.msg(res.msg, {icon: 2});
                        }
                    },
                    error: function(xhr, status, error) {
                        layer.msg('操作失败: ' + error, {icon: 2});
                    }
                });
            }
            
            // 删除错题/收藏
            function deleteWrongQuestion(id) {
                layer.confirm('确定要删除这条记录吗？', {
                    btn: ['确定', '取消']
                }, function(index) {
                    $.ajax({
                        url: 'api/wrong-questions.php?id=' + id,
                        method: 'DELETE',
                        dataType: 'json',
                        success: function(res) {
                            if(res.code === 200) {
                                layer.msg(res.msg, {icon: 1});
                                // 重新加载表格
                                table.reload('wrong-questions-table');
                            } else {
                                layer.msg(res.msg, {icon: 2});
                            }
                        },
                        error: function(xhr, status, error) {
                            layer.msg('删除失败: ' + error, {icon: 2});
                        }
                    });
                    
                    layer.close(index);
                });
            }
            
            // 切换类型
            function toggleWrongQuestionType(id, currentType) {
                var newType = currentType === 0 ? 1 : 0;
                var actionText = newType === 0 ? '错题' : '收藏';
                
                layer.confirm('确定要切换为' + actionText + '吗？', {
                    btn: ['确定', '取消']
                }, function(index) {
                    $.ajax({
                        url: 'api/wrong-questions.php',
                        method: 'PUT',
                        contentType: 'application/json',
                        data: JSON.stringify({id: id, type: newType}),
                        dataType: 'json',
                        success: function(res) {
                            if(res.code === 200) {
                                layer.msg(res.msg, {icon: 1});
                                // 重新加载表格
                                table.reload('wrong-questions-table');
                            } else {
                                layer.msg(res.msg, {icon: 2});
                            }
                        },
                        error: function(xhr, status, error) {
                            layer.msg('操作失败: ' + error, {icon: 2});
                        }
                    });
                    
                    layer.close(index);
                });
            }
            
            // 类型切换按钮点击事件
            $('.layui-btn-group').on('click', 'button', function() {
                var type = parseInt($(this).data('type'));
                if(type === currentType) return;
                
                // 更新按钮样式
                $('.layui-btn-group button').removeClass('layui-btn-primary');
                $('.layui-btn-group button').addClass('layui-btn-primary');
                $(this).removeClass('layui-btn-primary');
                
                // 更新当前类型
                currentType = type;
                
                // 重新加载表格
                initWrongQuestionsTable();
            });
            
            // 搜索按钮点击事件
            $('#search-wrong-question').on('click', function() {
                var reviewed = $('#search-reviewed').val();
                
                // 重新加载表格
                table.reload('wrong-questions-table', {
                    where: {
                        type: currentType,
                        reviewed: reviewed
                    }
                });
            });
            
            // 重置按钮点击事件
            $('#reset-wrong-question').on('click', function() {
                $('#search-user').val('');
                $('#search-reviewed').val('-1');
                form.render('select');
                
                // 重新加载表格
                table.reload('wrong-questions-table', {
                    where: {
                        type: currentType,
                        reviewed: -1
                    }
                });
            });
            
            // 题目管理相关功能
            // 初始化题目表格
            function initQuestionsTable() {
                table.render({
                    elem: '#questions-table',
                    url: 'api/questions.php',
                    method: 'GET',
                    page: false,
                    limit: 20,
                    height: 'full-150',
                    request: {
                        pageName: 'page', // 页码的参数名称，默认：page
                        limitName: 'limit' // 每页数据量的参数名，默认：limit
                    },
                    response: {
                        statusName: 'code', // 规定数据状态的字段名称，默认：code
                        statusCode: 200, // 规定成功的状态码，默认：0
                        msgName: 'msg', // 规定状态信息的字段名称，默认：msg
                        countName: 'count', // 规定数据总数的字段名称，默认：count
                        dataName: 'data' // 规定数据列表的字段名称，默认：data
                    },
                    cols: [[
                        {field: 'id', title: 'ID', width: 80, align: 'center'},
                        {field: 'type', title: '类型', width: 100, align: 'center', templet: '<div>{{d.type === 1 ? "单选" : d.type === 2 ? "多选" : d.type === 3 ? "判断" : d.type === 4 ? "填空" : "简答"}}</div>'},
                        {field: 'content', title: '题目内容', minWidth: 300},
                        {field: 'difficulty', title: '难度', width: 100, align: 'center', templet: '<div>{{d.difficulty === 1 ? "简单" : d.difficulty === 2 ? "中等" : "困难"}}</div>'},
                        {field: 'status', title: '状态', width: 100, align: 'center', templet: '<div>{{d.status === 1 ? "启用" : "禁用"}}</div>'},
                        {field: 'created_at', title: '创建时间', width: 160, align: 'center'},
                        {fixed: 'right', title: '操作', width: 160, align: 'center', toolbar: '#questions-toolbar'}
                    ]],
                    done: function(res) {
                        if(res.code === 200) {
                            // 更新统计数据
                            $('#total-questions').text(res.data.length);
                        }
                    }
                });
                
                // 绑定工具栏事件
                table.on('tool(questions-filter)', function(obj) {
                    var data = obj.data;
                    if(obj.event === 'edit') {
                        // 编辑题目
                        editQuestion(data);
                    } else if(obj.event === 'del') {
                        // 删除题目
                        deleteQuestion(data.id);
                    }
                });
                
                // 加载分类选项
                loadQuestionCategories();
                // 加载题库选项
                loadBankOptions();
            }
            
            // 加载分类选项（只用于题库添加表单）
            function loadQuestionCategories() {
                $.ajax({
                    url: 'api/categories.php',
                    method: 'GET',
                    dataType: 'json',
                    success: function(res) {
                        if(res.code === 200) {
                            var categories = res.data;
                            // 只用于题库添加表单的分类选择
                            var select = $('select[name="category_id"]');
                            // 清空现有选项（保留顶级分类）
                            select.find('option:not([value="0"])').remove();
                            
                            // 添加分类选项
                            categories.forEach(function(category) {
                                if(category.parent_id === 0) {
                                    select.append('<option value="' + category.id + '">' + category.name + '</option>');
                                }
                            });
                            
                            // 重新渲染表单
                            form.render('select');
                        }
                    }
                });
            }
            
            // 题目类型切换事件
            form.on('select(question-type)', function(data) {
                var type = parseInt(data.value);
                if(type === 1 || type === 2 || type === 3) {
                    // 选择题和判断题，显示选项输入
                    $('.choice-options').show();
                    $('.answer-section').hide();
                    
                    // 显示添加选项按钮，使用和单选一样的UI
                    $('#add-option').show();
                } else {
                    // 非选择题，显示答案输入
                    $('.choice-options').hide();
                    $('.answer-section').show();
                }
            });
            
            // 生成判断题固定选项
            function generateJudgmentOptions() {
                var container = $('.options-container');
                container.html('');
                
                // 判断题固定选项：正确、错误
                var options = [
                    { letter: 'A', content: '正确' },
                    { letter: 'B', content: '错误' }
                ];
                
                options.forEach(function(option, index) {
                    var optionHtml = '<div class="option-item" style="margin-bottom: 10px;">' +
                        '<div class="layui-row">' +
                            '<div class="layui-col-md1">' +
                                '<div class="layui-form-mid layui-word-aux" style="font-weight: bold; font-size: 16px;">' + option.letter + '</div>' +
                                '<input type="hidden" name="options[' + index + '][letter]" value="' + option.letter + '">' +
                            '</div>' +
                            '<div class="layui-col-md10">' +
                                '<input type="text" name="options[' + index + '][content]" value="' + option.content + '" placeholder="选项内容" class="layui-input" style="margin-bottom: 5px;" lay-verify="requiredOption" readonly>' +
                            '</div>' +
                            '<div class="layui-col-md1">' +
                                '<input type="radio" name="judgment_option_is_correct" lay-skin="primary" title="正确" value="1">' +
                            '</div>' +
                        '</div>' +
                    '</div>';
                    container.append(optionHtml);
                });
                
                // 隐藏添加选项按钮
                $('#add-option').hide();
                
                // 重新渲染表单
                form.render('radio');
                form.render();
                
                // 绑定选项事件
                bindOptionEvents();
                
                // 初始化答案
                syncCheckboxToAnswer();
            }
            
            // 添加选项按钮点击事件
            $('#add-option').on('click', function() {
                var container = $('.options-container');
                var index = container.find('.option-item').length;
                var letters = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J'];
                var letter = letters[index] || String.fromCharCode(65 + index); // A的ASCII码是65
                
                var optionHtml = '<div class="option-item" style="margin-bottom: 10px;">' +
                    '<div class="layui-row">' +
                        '<div class="layui-col-md1">' +
                            '<div class="layui-form-mid layui-word-aux" style="font-weight: bold; font-size: 16px;">' + letter + '</div>' +
                            '<input type="hidden" name="options[' + index + '][letter]" value="' + letter + '">' +
                        '</div>' +
                        '<div class="layui-col-md10">' +
                            '<input type="text" name="options[' + index + '][content]" placeholder="选项内容" class="layui-input" style="margin-bottom: 5px;" lay-verify="requiredOption">' +
                        '</div>' +
                        '<div class="layui-col-md1">' +
                            '<input type="checkbox" name="options[' + index + '][is_correct]" lay-skin="primary" title="正确">' +
                        '</div>' +
                    '</div>' +
                '</div>';
                
                container.append(optionHtml);
                form.render('checkbox');
                // 重新渲染表单验证规则
                form.render();
                // 绑定新添加选项的事件
                bindOptionEvents();
                // 同步到批量输入
                syncSingleToBatch();
            });
            
            // 绑定选项事件
            function bindOptionEvents() {
                // 绑定单条选项内容输入事件
                $('.option-item input[name^="options["][name$="][content]"]').off('input').on('input', function() {
                    syncSingleToBatch();
                });
                
                // 绑定选项正确答案选择事件（使用 LayUI 事件监听）
                form.on('checkbox', function(data) {
                    if($(data.elem).closest('.option-item').length > 0) {
                        syncCheckboxToAnswer();
                        updateQuestionType();
                    }
                });
            }
            
            // 单条输入到批量输入的同步
            function syncSingleToBatch() {
                var options = [];
                $('.option-item input[name^="options["][name$="][content]"]').each(function() {
                    var content = $(this).val().trim();
                    if(content) {
                        options.push(content);
                    }
                });
                $('input[name="batch_options"]').val(options.join('|'));
            }
            
            // 批量输入到单条输入的同步
            function syncBatchToSingle() {
                var batchContent = $('input[name="batch_options"]').val().trim();
                if(!batchContent) return;
                
                var options = batchContent.split('|');
                var container = $('.options-container');
                
                // 清空现有选项
                container.html('');
                
                // 生成新的选项
                options.forEach(function(option, index) {
                    var optionContent = option.trim();
                    if(optionContent) {
                        // 根据索引生成字母（A的ASCII码是65）
                        var letter = String.fromCharCode(65 + index);
                        var optionHtml = '<div class="option-item" style="margin-bottom: 10px;">' +
                            '<div class="layui-row">' +
                                '<div class="layui-col-md1">' +
                                    '<div class="layui-form-mid layui-word-aux" style="font-weight: bold; font-size: 16px;">' + letter + '</div>' +
                                    '<input type="hidden" name="options[' + index + '][letter]" value="' + letter + '">' +
                                '</div>' +
                                '<div class="layui-col-md10">' +
                                    '<input type="text" name="options[' + index + '][content]" value="' + optionContent + '" placeholder="选项内容" class="layui-input" style="margin-bottom: 5px;" lay-verify="requiredOption">' +
                                '</div>' +
                                '<div class="layui-col-md1">' +
                                    '<input type="checkbox" name="options[' + index + '][is_correct]" lay-skin="primary" title="正确">' +
                                '</div>' +
                            '</div>' +
                        '</div>';
                        container.append(optionHtml);
                    }
                });
                
                // 重新渲染表单
                form.render();
                // 绑定事件
                bindOptionEvents();
                // 同步答案到复选框
                syncAnswerToCheckbox();
                // 更新题型
                updateQuestionType();
            }
            
            // 单条选择框到答案输入框的同步
            function syncCheckboxToAnswer() {
                var answer = '';
                // 遍历所有选项，检查是否被选中
                $('.option-item').each(function(index) {
                    var optionItem = $(this);
                    var isChecked = false;
                    
                    // 检查是否有选中的复选框或单选按钮
                    var checkbox = optionItem.find('input[type="checkbox"]');
                    var radio = optionItem.find('input[type="radio"]');
                    
                    if(checkbox.length > 0) {
                        isChecked = checkbox.prop('checked');
                    } else if(radio.length > 0) {
                        // 判断题的单选按钮特殊处理
                        var currentType = $('select[name="type"]').val();
                        if(currentType === '3') {
                            // 判断题，检查当前单选按钮是否被选中
                            isChecked = radio.prop('checked');
                        } else {
                            isChecked = radio.prop('checked');
                        }
                    }
                    
                    if (isChecked) {
                        // 直接从选项元素中获取字母
                        var letter = optionItem.find('.layui-form-mid').text().trim();
                        answer += letter;
                    }
                });
                $('input[name="answer"]').val(answer);
            }
            
            // 答案输入框到单条选择框的同步
            function syncAnswerToCheckbox() {
                var answer = $('input[name="answer"]').val().toUpperCase();
                var currentType = $('select[name="type"]').val();
                
                // 清空所有选择框和单选按钮
                $('.option-item input[name^="options["][name$="][is_correct]"]').prop('checked', false);
                $('.option-item input[name="judgment_option_is_correct"]').prop('checked', false);
                
                // 选中对应选择框或单选按钮
                $('.option-item').each(function() {
                    // 直接从选项元素中获取字母
                    var itemLetter = $(this).find('.layui-form-mid').text().trim().toUpperCase();
                    if(answer.includes(itemLetter)) {
                        // 查找当前选项的正确答案选择器
                        var correctSelector = $(this).find('input[name^="options["][name$="][is_correct]"]');
                        var judgmentSelector = $(this).find('input[name="judgment_option_is_correct"]');
                        
                        if(correctSelector.length > 0) {
                            correctSelector.prop('checked', true);
                        } else if(judgmentSelector.length > 0) {
                            judgmentSelector.prop('checked', true);
                        }
                    }
                });
                
                // 重新渲染表单
                form.render();
            }
            
            // 更新题型
            function updateQuestionType() {
                var currentType = $('select[name="type"]').val();
                
                // 只处理单选和多选题型的自动切换
                if(currentType === '1' || currentType === '2') {
                    var answer = $('input[name="answer"]').val().toUpperCase();
                    var checkedCount = $('.option-item input[name^="options["][name$="][is_correct]"]:checked').length;
                    var type = '1'; // 默认单选
                    
                    // 当答案长度>1或选中数量>1时，自动切换为多选
                    if(answer.length > 1 || checkedCount > 1) {
                        type = '2'; // 多选
                    }
                    
                    $('select[name="type"]').val(type);
                    // 重新渲染表单
                    form.render();
                }
            }
            
            // 初始化事件绑定
            function initOptionEvents() {
                // 绑定批量输入事件
                $('input[name="batch_options"]').off('input').on('input', function() {
                    syncBatchToSingle();
                });
                
                // 绑定答案输入事件
                $('input[name="answer"]').off('input').on('input', function() {
                    syncAnswerToCheckbox();
                    updateQuestionType();
                });
                
                // 绑定题型变化事件
                form.on('select(question-type)', function(data) {
                    var type = data.value;
                    if(type === '1' || type === '2') {
                        // 选择题，显示选项输入
                        $('.choice-options').show();
                        $('.answer-section').hide();
                    } else {
                        // 非选择题，显示答案输入
                        $('.choice-options').hide();
                        $('.answer-section').show();
                    }
                });
                
                // 初始绑定单条选项事件
                bindOptionEvents();
                // 初始同步单条输入到批量输入
                syncSingleToBatch();
            }
            
            // 监听题目内容输入事件，检测tab分隔符
            $('textarea[name="content"]').on('input', function() {
                var content = $(this).val();
                if(content.includes('\t')) {
                    var parts = content.split('\t');
                    if(parts.length >= 4) {
                        // 第一项是题目内容
                        $(this).val(parts[0]);
                        
                        // 第二项是选项内容，用竖线分隔
                        var options = parts[1].trim();
                        if(options) {
                            $('input[name="batch_options"]').val(options);
                            syncBatchToSingle();
                        }
                        
                        // 第三项是答案
                        var answer = parts[2].trim();
                        if(answer) {
                            $('input[name="answer"]').val(answer);
                            syncAnswerToCheckbox();
                            updateQuestionType();
                        }
                        
                        // 第四项是解析
                        var analysis = parts[3].trim();
                        if(analysis) {
                            $('textarea[name="analysis"]').val(analysis);
                        }
                    }
                }
            });
            
            // 初始化选项事件
            initOptionEvents();
            
            // 添加题目按钮点击事件
            $('#add-question-btn').on('click', function() {
                // 隐藏题目列表，显示添加题目表单
                $('#questions').hide();
                $('#add-question').show();
                
                // 清空表单
                $('#question-form')[0].reset();
                $('input[name="id"]').val('');
                
                // 切换到单选类型
                $('select[name="type"]').val('1').trigger('change');
                
                // 加载题库选项
                loadBankOptions();
                
                form.render('select');
                
                // 重新绑定选项事件
                initOptionEvents();
            });
            
            // 返回列表按钮点击事件
            $('#back-to-questions').on('click', function() {
                // 隐藏添加题目表单，显示题目列表
                $('#add-question').hide();
                $('#questions').show();
            });
            
            // 搜索按钮点击事件
            $('#search-btn').on('click', function() {
                var bank_id = $('#search-bank').val();
                var type = $('#search-type').val();
                
                // 重新加载表格
                table.reload('questions-table', {
                    where: {
                        bank_id: bank_id || 0,
                        type: type || 0
                    }
                });
            });
            
            // 重置按钮点击事件
            $('#reset-btn').on('click', function() {
                $('#search-bank').val('0');
                $('#search-type').val('0');
                form.render('select');
                
                // 重新加载表格
                table.reload('questions-table', {
                    where: {
                        bank_id: 0,
                        type: 0
                    }
                });
            });
            
            // 编辑题目
            function editQuestion(question) {
                // 隐藏题目列表，显示编辑表单
                $('#questions').hide();
                $('#add-question').show();
                
                // 加载题库选项
                loadBankOptions();
                
                // 填充表单数据
                $('input[name="id"]').val(question.id);
                $('select[name="bank_id"]').val(question.bank_id);
                $('select[name="type"]').val(question.type);
                $('select[name="difficulty"]').val(question.difficulty);
                $('textarea[name="content"]').val(question.content);
                
                // 根据题目类型填充答案
                if(question.type === 4 || question.type === 5) {
                    // 填空题、简答题
                    $('textarea[name="non_choice_answer"]').val(question.answer);
                } else {
                    // 选择题和判断题
                    $('input[name="answer"]').val(question.answer);
                    
                    // 解析选项
                    if(question.type === 3) {
                        // 判断题，使用和单选一样的UI
                        var options = question.options.split('|');
                        var container = $('.options-container');
                        container.html('');
                        
                        options.forEach(function(option, index) {
                            var letter = String.fromCharCode(65 + index);
                            var isCorrect = question.answer.includes(letter) ? 'checked' : '';
                            
                            var optionHtml = '<div class="option-item" style="margin-bottom: 10px;">' +
                                '<div class="layui-row">' +
                                    '<div class="layui-col-md1">' +
                                        '<div class="layui-form-mid layui-word-aux" style="font-weight: bold; font-size: 16px;">' + letter + '</div>' +
                                        '<input type="hidden" name="options[' + index + '][letter]" value="' + letter + '">' +
                                    '</div>' +
                                    '<div class="layui-col-md10">' +
                                        '<input type="text" name="options[' + index + '][content]" value="' + option + '" placeholder="选项内容" class="layui-input" style="margin-bottom: 5px;" lay-verify="requiredOption">' +
                                    '</div>' +
                                    '<div class="layui-col-md1">' +
                                        '<input type="checkbox" name="options[' + index + '][is_correct]" lay-skin="primary" title="正确" ' + isCorrect + '>' +
                                    '</div>' +
                                '</div>' +
                            '</div>';
                            
                            container.append(optionHtml);
                        });
                    } else {
                        // 单选题和多选题
                        var options = question.options.split('|');
                        var container = $('.options-container');
                        container.html('');
                        
                        options.forEach(function(option, index) {
                            var letter = String.fromCharCode(65 + index);
                            var isCorrect = question.answer.includes(letter) ? 'checked' : '';
                            
                            var optionHtml = '<div class="option-item" style="margin-bottom: 10px;">' +
                                '<div class="layui-row">' +
                                    '<div class="layui-col-md1">' +
                                        '<div class="layui-form-mid layui-word-aux" style="font-weight: bold; font-size: 16px;">' + letter + '</div>' +
                                        '<input type="hidden" name="options[' + index + '][letter]" value="' + letter + '">' +
                                    '</div>' +
                                    '<div class="layui-col-md10">' +
                                        '<input type="text" name="options[' + index + '][content]" value="' + option + '" placeholder="选项内容" class="layui-input" style="margin-bottom: 5px;" lay-verify="requiredOption">' +
                                    '</div>' +
                                    '<div class="layui-col-md1">' +
                                        '<input type="checkbox" name="options[' + index + '][is_correct]" lay-skin="primary" title="正确" ' + isCorrect + '>' +
                                    '</div>' +
                                '</div>' +
                            '</div>';
                            
                            container.append(optionHtml);
                        });
                    }
                }
                
                // 填充解析
                $('textarea[name="analysis"]').val(question.analysis);
                
                // 触发类型变化事件，显示正确的输入区域
                $('select[name="type"]').trigger('change');
                
                // 重新渲染表单
                form.render();
                
                // 绑定选项事件
                bindOptionEvents();
                
                // 同步单条输入到批量输入
                syncSingleToBatch();
                
                // 同步答案到复选框
                syncAnswerToCheckbox();
            }
            
            // 删除题目
            function deleteQuestion(id) {
                layer.confirm('确定要删除这个题目吗？', {
                    btn: ['确定', '取消']
                }, function(index) {
                    $.ajax({
                        url: 'api/questions.php?id=' + id,
                        method: 'DELETE',
                        dataType: 'json',
                        success: function(res) {
                            if(res.code === 200) {
                                layer.msg(res.msg, {icon: 1});
                                // 重新加载表格
                                table.reload('questions-table');
                            } else {
                                layer.msg(res.msg, {icon: 2});
                            }
                        },
                        error: function(xhr, status, error) {
                            layer.msg('删除失败: ' + error, {icon: 2});
                        }
                    });
                    
                    layer.close(index);
                });
            }
            
            // 监听题目表单提交
            form.on('submit(submit-question)', function(data) {
                var questionData = data.field;
                var url = 'api/questions.php';
                var method = questionData.id ? 'PUT' : 'POST';
                
                // 前端验证
                if(questionData.type === '3' || questionData.type === '4' || questionData.type === '5') {
                    // 判断题、填空题、简答题需要验证答案
                    if(!questionData.non_choice_answer || questionData.non_choice_answer.trim() === '') {
                        layer.msg('答案不能为空', {icon: 2});
                        return false;
                    }
                    // 将非选择题答案赋值给answer字段
                    questionData.answer = questionData.non_choice_answer;
                    // 删除临时字段
                    delete questionData.non_choice_answer;
                }
                
                // 处理选项数据
                if(questionData.type === '1' || questionData.type === '2' || questionData.type === '3') {
                    var options = [];
                    var hasCorrectAnswer = false;
                    
                    // 获取所有选项
                    $('.option-item').each(function(index) {
                        var optionItem = $(this);
                        var content = optionItem.find('input[name^="options[' + index + '][content]"]').val();
                        var isCorrect = optionItem.find('input[name^="options[' + index + '][is_correct]"]').is(':checked') ? 1 : 0;
                        
                        if(isCorrect) {
                            hasCorrectAnswer = true;
                        }
                        
                        if(content) {
                            options.push(content);
                        }
                    });
                    
                    // 验证选择题必须有正确答案
                    if(!hasCorrectAnswer) {
                        layer.msg('选择题必须至少有一个正确答案', {icon: 2});
                        return false;
                    }
                    
                    // 生成选项字符串，只保存选项内容，用竖线分隔
                    questionData.options = options.join('|');
                    
                    // 验证正确答案是否为字母格式
                    if(!questionData.answer || questionData.answer.trim() === '') {
                        layer.msg('正确答案不能为空', {icon: 2});
                        return false;
                    }
                    
                    // 验证答案只包含字母
                    var answerPattern = /^[A-Za-z]+$/;
                    if(!answerPattern.test(questionData.answer)) {
                        layer.msg('正确答案只能包含字母（如：A、AC、B）', {icon: 2});
                        return false;
                    }
                }
                
                // 提交时自动检测并修改为相对应的题型
                if(questionData.type === '1' || questionData.type === '2') {
                    var answer = questionData.answer.toUpperCase();
                    var checkedCount = $('.option-item input[name^="options["][name$="][is_correct]"]:checked').length;
                    
                    // 当答案长度>1或选中数量>1时，自动切换为多选
                    if(answer.length > 1 || checkedCount > 1) {
                        questionData.type = '2'; // 多选
                    } else {
                        questionData.type = '1'; // 单选
                    }
                }
                
                $.ajax({
                    url: url,
                    method: method,
                    contentType: 'application/json',
                    data: JSON.stringify(questionData),
                    dataType: 'json',
                    success: function(res) {
                        if(res.code === 200 || res.code === 201) {
                            layer.msg(res.msg, {icon: 1});
                            // 返回列表并刷新
                            $('#add-question').hide();
                            $('#questions').show();
                            table.reload('questions-table');
                        } else {
                            layer.msg(res.msg, {icon: 2});
                        }
                    },
                    error: function(xhr, status, error) {
                        layer.msg('操作失败: ' + error, {icon: 2});
                    }
                });
                
                return false;
            });
            
            // 题库管理相关功能
            // 初始化题库表格
            function initBanksTable() {
                table.render({
                    elem: '#banks-table',
                    url: 'api/banks.php',
                    method: 'GET',
                    page: false,
                    limit: 20,
                    height: 'full-150',
                    request: {
                        pageName: 'page', // 页码的参数名称，默认：page
                        limitName: 'limit' // 每页数据量的参数名，默认：limit
                    },
                    response: {
                        statusName: 'code', // 规定数据状态的字段名称，默认：code
                        statusCode: 200, // 规定成功的状态码，默认：0
                        msgName: 'msg', // 规定状态信息的字段名称，默认：msg
                        countName: 'count', // 规定数据总数的字段名称，默认：count
                        dataName: 'data' // 规定数据列表的字段名称，默认：data
                    },
                    cols: [[
                        {field: 'id', title: 'ID', width: 80, align: 'center'},
                        {field: 'name', title: '题库名称', minWidth: 150},
                        {field: 'category_name', title: '所属分类', width: 150, align: 'center'},
                        {field: 'description', title: '描述', minWidth: 300},
                        {field: 'status', title: '状态', width: 100, align: 'center', templet: '<div>{{d.status === 1 ? "启用" : "禁用"}}</div>'},
                        {field: 'created_at', title: '创建时间', width: 160, align: 'center'},
                        {field: 'updated_at', title: '更新时间', width: 160, align: 'center'},
                        {fixed: 'right', title: '操作', width: 160, align: 'center', toolbar: '#banks-toolbar'}
                    ]],
                    done: function(res) {
                        if(res.code === 200) {
                            // 加载题库选项到题目表单
                            loadBankOptions();
                            // 加载分类选项到题库表单
                            loadCategoryOptionsToBankForm();
                        }
                    }
                });
                
                // 绑定工具栏事件
                table.on('tool(banks-filter)', function(obj) {
                    var data = obj.data;
                    if(obj.event === 'edit') {
                        // 编辑题库
                        editBank(data);
                    } else if(obj.event === 'del') {
                        // 删除题库
                        deleteBank(data.id);
                    }
                });
            }
            
            // 加载题库选项
            function loadBankOptions() {
                $.ajax({
                    url: 'api/banks.php',
                    method: 'GET',
                    dataType: 'json',
                    success: function(res) {
                        if(res.code === 200) {
                            var banks = res.data;
                            var bankSelects = ['#search-bank', 'select[name="bank_id"]'];
                            
                            bankSelects.forEach(function(selector) {
                                var select = $(selector);
                                select.find('option:not(:first)').remove();
                                
                                banks.forEach(function(bank) {
                                    select.append('<option value="' + bank.id + '">' + bank.name + '</option>');
                                });
                            });
                            
                            form.render('select');
                        } else {
                            // 显示API错误信息
                            layer.msg('加载题库失败：' + res.msg, {icon: 2});
                        }
                    },
                    error: function(xhr, status, error) {
                        // 显示AJAX错误信息
                        layer.msg('加载题库失败：' + error, {icon: 2});
                        console.error('AJAX错误：', status, error);
                    }
                });
            }
            
            // 加载分类选项到题库表单
            function loadCategoryOptionsToBankForm() {
                $.ajax({
                    url: 'api/categories.php',
                    method: 'GET',
                    dataType: 'json',
                    success: function(res) {
                        if(res.code === 200) {
                            var categories = res.data;
                            var select = $('select[name="category_id"]');
                            select.find('option:not(:first)').remove();
                            
                            categories.forEach(function(category) {
                                select.append('<option value="' + category.id + '">' + category.name + '</option>');
                            });
                            
                            form.render('select');
                        }
                    }
                });
            }
            
            // 添加题库按钮点击事件
            $('#add-bank-btn').on('click', function() {
                // 隐藏题库列表，显示添加题库表单
                $('#banks').hide();
                $('#add-bank').show();
                
                // 清空表单
                $('#bank-form')[0].reset();
                $('input[name="id"]').val('');
            });
            
            // 返回题库列表按钮点击事件
            $('#back-to-banks').on('click', function() {
                // 隐藏添加题库表单，显示题库列表
                $('#add-bank').hide();
                $('#banks').show();
            });
            
            // 编辑题库
            function editBank(bank) {
                // 隐藏题库列表，显示编辑表单
                $('#banks').hide();
                $('#add-bank').show();
                
                // 填充表单数据
                $('input[name="id"]').val(bank.id);
                $('input[name="name"]').val(bank.name);
                $('textarea[name="description"]').val(bank.description);
                
                // 重新渲染表单
                form.render();
            }
            
            // 删除题库
            function deleteBank(id) {
                layer.confirm('确定要删除这个题库吗？', {
                    btn: ['确定', '取消']
                }, function(index) {
                    $.ajax({
                        url: 'api/banks.php?id=' + id,
                        method: 'DELETE',
                        dataType: 'json',
                        success: function(res) {
                            if(res.code === 200) {
                                layer.msg(res.msg, {icon: 1});
                                // 重新加载表格
                                table.reload('banks-table');
                            } else {
                                layer.msg(res.msg, {icon: 2});
                            }
                        },
                        error: function(xhr, status, error) {
                            layer.msg('删除失败: ' + error, {icon: 2});
                        }
                    });
                    
                    layer.close(index);
                });
            }
            
            // 监听题库表单提交
            form.on('submit(submit-bank)', function(data) {
                var bankData = data.field;
                var url = 'api/banks.php';
                var method = bankData.id ? 'PUT' : 'POST';
                
                $.ajax({
                    url: url,
                    method: method,
                    contentType: 'application/json',
                    data: JSON.stringify(bankData),
                    dataType: 'json',
                    success: function(res) {
                        if(res.code === 200 || res.code === 201) {
                            layer.msg(res.msg, {icon: 1});
                            // 返回列表并刷新
                            $('#add-bank').hide();
                            $('#banks').show();
                            table.reload('banks-table');
                        } else {
                            layer.msg(res.msg, {icon: 2});
                        }
                    },
                    error: function(xhr, status, error) {
                        layer.msg('操作失败: ' + error, {icon: 2});
                    }
                });
                
                return false;
            });
            
            // 导入数据相关功能
            var parsedData = [];
            
            // 解析数据
            function parseData() {
                var data = $('textarea[name="import_data"]').val();
                if(!data) {
                    layer.msg('请先输入要导入的数据', {icon: 2});
                    return;
                }
                
                var lines = data.split('\n');
                parsedData = [];
                var successCount = 0;
                var errorCount = 0;
                
                // 清空解析结果
                $('#parse-result-body').html('');
                
                // 解析每一行数据
                lines.forEach(function(line, index) {
                    line = line.trim();
                    if(!line) return;
                    
                    var parts = line.split('\t');
                    if(parts.length >= 5) {
                        var num = parts[0].trim();
                        var typeText = parts[1].trim();
                        var content = parts[2].trim();
                        var options = parts[3].trim();
                        var answer = parts[4].trim();
                        var analysis = parts[5] ? parts[5].trim() : '';
                        
                        // 转换类型
                        var type = 0;
                        // 移除类型文本中的"题"字，以支持"单选题"、"多选题"等格式
                        typeText = typeText.replace('题', '');
                        switch(typeText) {
                            case '单选':
                                type = 1;
                                break;
                            case '多选':
                                type = 2;
                                break;
                            case '判断':
                                type = 3;
                                break;
                            case '填空':
                                type = 4;
                                break;
                            case '简答':
                                type = 5;
                                break;
                            default:
                                errorCount++;
                                return;
                        }
                        
                        // 处理选项
                        var optionsArray = [];
                        if(type === 1 || type === 2) {
                            // 单选题和多选题
                            var optionContents = options.split('|');
                            optionContents.forEach(function(optionContent, optionIndex) {
                                optionContent = optionContent.trim();
                                if(optionContent) {
                                    optionsArray.push(optionContent);
                                }
                            });
                        }
                        
                        // 构建题目数据
                        var questionData = {
                            type: type,
                            content: content,
                            options: optionsArray.join('|'),
                            answer: answer,
                            analysis: analysis,
                            difficulty: 2, // 默认中等难度
                            bank_id: 1, // 默认题库ID为1
                            status: 1 // 默认启用
                        };
                        
                        parsedData.push(questionData);
                        successCount++;
                        
                        // 添加到预览表格
                        var optionsDisplay = type === 4 || type === 5 ? '-' : options;
                        var tr = '<tr>' +
                            '<td>' + num + '</td>' +
                            '<td>' + typeText + '</td>' +
                            '<td>' + content + '</td>' +
                            '<td>' + optionsDisplay + '</td>' +
                            '<td>' + answer + '</td>' +
                            '<td>' + analysis + '</td>' +
                            '</tr>';
                        $('#parse-result-body').append(tr);
                    } else {
                        errorCount++;
                    }
                });
                
                // 显示解析结果
                if(successCount > 0) {
                    $('#parse-result').show();
                    $('#parse-status').html('<span style="color: #23915f;">解析成功：' + successCount + '条记录，失败：' + errorCount + '条记录</span>').show();
                } else {
                    $('#parse-result').hide();
                    $('#parse-status').html('<span style="color: #ff5722;">解析失败，请检查数据格式</span>').show();
                }
                
                layer.msg('解析完成，成功：' + successCount + '条，失败：' + errorCount + '条', {icon: 1});
            }
            
            // 导入数据
            function importData() {
                if(parsedData.length === 0) {
                    layer.msg('请先解析数据', {icon: 2});
                    return;
                }
                
                layer.confirm('确定要导入' + parsedData.length + '条题目吗？', {
                    btn: ['确定', '取消']
                }, function(index) {
                    // 关闭确认框
                    layer.close(index);
                    
                    // 发送数据到后端
                    $.ajax({
                        url: 'api/questions.php',
                        method: 'POST',
                        contentType: 'application/json',
                        data: JSON.stringify(parsedData),
                        dataType: 'json',
                        success: function(res) {
                            if(res.code === 200 || res.code === 201) {
                                layer.msg('导入成功：' + res.data.success + '条，失败：' + res.data.failed + '条', {icon: 1});
                                // 清空输入和解析结果
                                $('textarea[name="import_data"]').val('');
                                $('#parse-result').hide();
                                $('#parse-status').hide();
                                parsedData = [];
                                // 刷新题目列表
                                if($('#questions').is(':visible')) {
                                    initQuestionsTable();
                                }
                            } else {
                                layer.msg('导入失败：' + res.msg, {icon: 2});
                            }
                        },
                        error: function(xhr, status, error) {
                            layer.msg('导入失败：' + error, {icon: 2});
                        }
                    });
                });
            }
            
            // 绑定解析按钮事件
            $('#parse-btn').on('click', function() {
                parseData();
            });
            
            // 绑定导入按钮事件
            $('#import-btn').on('click', function() {
                importData();
            });
            
            // 页面加载时执行
            $(function() {
                loadStats();
            });
        });
    </script>
</body>
</html>